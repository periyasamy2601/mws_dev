pipeline {
    agent any

    environment {
        FLUTTER_HOME = "/opt/flutter"
        PATH = "${env.FLUTTER_HOME}/bin:/usr/local/bin:${env.PATH}"
    }

    stages {
        stage('Build Dev') {
            steps {
                dir('avk-frontend') {

                    echo 'Copying plist for iOS...'
                    sh 'cp lib/config/firebase/GoogleService-Info-dev.plist ios/Runner/GoogleService-Info.plist'

                    echo 'Copying google-services JSON for Android...'
                    sh 'cp lib/config/firebase/google-services-dev.json android/app/google-services.json'

                    echo 'Building Android APK (Dev)...'
                    sh 'flutter build apk --release -t lib/main_dev.dart'

                    echo 'Building Web (Dev)...'
                    sh 'flutter build web --release -t lib/main_dev.dart'
                }
            }
        }
    }

    post {
        success { echo 'Build Dev stage completed successfully!' }
        failure { echo 'Build Dev stage failed! Check logs.' }
    }
}
